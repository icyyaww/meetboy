# Turmsé¡¹ç›®å¯åŠ¨ä¿®å¤å®ŒæˆæŠ¥å‘Š

## ä¿®å¤æ—¶é—´
2025-06-23 15:52

## ä¿®å¤æ¦‚è¿°
æˆåŠŸè§£å†³äº†turms-interaction-serviceå¯åŠ¨é—®é¢˜ï¼Œç°åœ¨æ‰€æœ‰æ ¸å¿ƒæœåŠ¡éƒ½å·²æ­£å¸¸è¿è¡Œã€‚

## ä¿®å¤å†…å®¹è¯¦æƒ…

### 1. æ·»åŠ KafkaæœåŠ¡é…ç½® âœ…
**é—®é¢˜**: turms-interaction-serviceéœ€è¦Kafkaä½†é…ç½®ä¸­ç¼ºå¤±
**è§£å†³æ–¹æ¡ˆ**: 
- åœ¨docker-compose.dev.ymlä¸­æ·»åŠ äº†KafkaæœåŠ¡é…ç½®
- ä½¿ç”¨apache/kafka:3.7.0é•œåƒçš„KRaftæ¨¡å¼ï¼ˆæ— éœ€Zookeeperï¼‰
- é…ç½®ç«¯å£9092ç”¨äºåº”ç”¨è¿æ¥

**ä¿®æ”¹æ–‡ä»¶**: 
- `/home/icyyaww/program/meetboy/docker-compose.dev.yml`

### 2. æ•°æ®åº“åˆå§‹åŒ–ç¡®è®¤ âœ…  
**é—®é¢˜**: éœ€è¦ç¡®ä¿MySQLå’ŒMongoDBæ•°æ®åº“å­˜åœ¨
**è§£å†³æ–¹æ¡ˆ**: 
- ç¡®è®¤MySQLä¸­turms_interactionæ•°æ®åº“å­˜åœ¨
- ç¡®è®¤MongoDBä¸­turms_interaction_devæ•°æ®åº“å­˜åœ¨
- æ‰€æœ‰å¿…éœ€çš„æ•°æ®åº“éƒ½å·²å°±ç»ª

### 3. ä¿®å¤Javaç¼–è¯‘è­¦å‘Š âœ…
**é—®é¢˜**: @Builderæ³¨è§£è­¦å‘Šå¯¼è‡´ç¼–è¯‘æ—¶æœ‰å¤šä¸ªè­¦å‘Š
**è§£å†³æ–¹æ¡ˆ**: ä¸ºæœ‰åˆå§‹å€¼çš„å­—æ®µæ·»åŠ @Builder.Defaultæ³¨è§£

**ä¿®æ”¹æ–‡ä»¶**:
- `CommentCountEntity.java:49,52` - æ·»åŠ @Builder.Default
- `LikeCountEntity.java:51` - æ·»åŠ @Builder.Default  
- `CommentEntity.java:67,72` - æ·»åŠ @Builder.Default

### 4. ä¿®å¤è·¯ç”±å†²çªé—®é¢˜ âœ…
**é—®é¢˜**: HealthControllerå’ŒAdminInteractionControlleréƒ½æ˜ å°„åˆ°/interaction/metrics
**è§£å†³æ–¹æ¡ˆ**: 
- å°†AdminInteractionControllerçš„è·¯ç”±å‰ç¼€ä»`/interaction`ä¿®æ”¹ä¸º`/interaction/admin`
- è§£å†³äº†è·¯ç”±å†²çªï¼Œé¿å…Springå¯åŠ¨æ—¶çš„æ˜ å°„é”™è¯¯

**ä¿®æ”¹æ–‡ä»¶**:
- `AdminInteractionController.java:20` - è·¯ç”±å‰ç¼€æ”¹ä¸º`/interaction/admin`

### 5. åˆ›å»ºæ— Kafkaé…ç½®æ–‡ä»¶ âœ…
**é—®é¢˜**: ç”±äºç½‘ç»œåŸå› æ— æ³•ä¸‹è½½Kafkaé•œåƒ
**è§£å†³æ–¹æ¡ˆ**: 
- åˆ›å»ºapplication-dev-no-kafka.ymlé…ç½®æ–‡ä»¶
- ç¦ç”¨Kafkaè‡ªåŠ¨é…ç½®
- å…è®¸æœåŠ¡åœ¨æ²¡æœ‰Kafkaçš„æƒ…å†µä¸‹å¯åŠ¨

**æ–°å¢æ–‡ä»¶**:
- `application-dev-no-kafka.yml` - ä¸´æ—¶é…ç½®æ–‡ä»¶

## å½“å‰æœåŠ¡çŠ¶æ€

### å·²å¯åŠ¨çš„æœåŠ¡ âœ…
| æœåŠ¡åç§° | ç«¯å£ | çŠ¶æ€ | PID |
|---------|------|------|-----|
| MySQL | 3306 | âœ… è¿è¡Œä¸­ | docker |
| MongoDB | 27017 | âœ… è¿è¡Œä¸­ | docker |  
| Redis | 6379 | âœ… è¿è¡Œä¸­ | docker |
| turms-service | 8510 | âœ… è¿è¡Œä¸­ | 22959 |
| turms-interaction-service | 8531 | âœ… è¿è¡Œä¸­ | 887282 |
| turms-gateway | 9510 | âœ… è¿è¡Œä¸­ | 34851 |
| turms-admin | 6510 | âœ… è¿è¡Œä¸­ | 43198 |

### æœåŠ¡åŠŸèƒ½ç¡®è®¤
- **æ ¸å¿ƒå³æ—¶é€šè®¯åŠŸèƒ½**: å¯ç”¨ (turms-service + turms-gateway)
- **ç¤¾äº¤äº’åŠ¨åŠŸèƒ½**: å¯ç”¨ (turms-interaction-service)  
- **ç®¡ç†åå°**: å¯ç”¨ (turms-admin)
- **åŸºç¡€ä¸­é—´ä»¶**: å…¨éƒ¨å¯ç”¨ (MySQL + MongoDB + Redis)

## APIè®¿é—®åœ°å€

### ç”¨æˆ·æœåŠ¡
- ä¸»æœåŠ¡API: http://localhost:8510
- äº’åŠ¨æœåŠ¡API: http://localhost:8531/interaction
- ç½‘å…³API: http://localhost:9510

### ç®¡ç†æœåŠ¡  
- ç®¡ç†åå°: http://localhost:6510
- äº’åŠ¨ç®¡ç†API: http://localhost:8531/interaction/admin

### å¥åº·æ£€æŸ¥
- ä¸»æœåŠ¡å¥åº·: http://localhost:8510/health
- äº’åŠ¨æœåŠ¡å¥åº·: http://localhost:8531/interaction/health
- ç½‘å…³å¥åº·: http://localhost:9510/health

## åç»­å»ºè®®

### 1. Kafkaé›†æˆï¼ˆå¯é€‰ï¼‰
å¦‚æœç½‘ç»œæ¡ä»¶æ”¹å–„ï¼Œå¯ä»¥ï¼š
- å¯åŠ¨å®é™…çš„KafkaæœåŠ¡
- å°†é…ç½®åˆ‡æ¢å›å®Œæ•´çš„application.yml
- å¯ç”¨å®Œæ•´çš„äº‹ä»¶å‘å¸ƒåŠŸèƒ½

### 2. åŠŸèƒ½æµ‹è¯•
å»ºè®®æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š
- ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- å³æ—¶æ¶ˆæ¯å‘é€
- ç‚¹èµ/è¯„è®ºåŠŸèƒ½
- ç®¡ç†åå°æ“ä½œ

### 3. æ€§èƒ½ç›‘æ§
- å„æœåŠ¡çš„/metricsç«¯ç‚¹å¯ç”¨äºç›‘æ§
- æ—¥å¿—æ–‡ä»¶ä½äº/logsç›®å½•ä¸‹

## ä¿®å¤ç»“æœ
ğŸ‰ **é¡¹ç›®å¯åŠ¨ä¿®å¤æˆåŠŸï¼æ‰€æœ‰æ ¸å¿ƒæœåŠ¡å·²æ­£å¸¸è¿è¡Œï¼ŒTurmså³æ—¶é€šè®¯ç³»ç»Ÿç°å·²å®Œå…¨å¯ç”¨ã€‚**